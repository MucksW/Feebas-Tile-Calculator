<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Feebas Tile Calculator</title>

    <style>
        body {
        	font-family: 'Arial', sans-serif;
            display: flex;
            background-color: #f4f4f4;
            margin: 20px;
        }

        #disclaimer {
		  background-color: #ffffcc;
		  border-left: 6px solid #ffeb3b;
		  padding: 4px 12px;
		  text-align: justify;
		}

        #imageContainer {
            width:641px;
      		height:1553px;
      		margin-bottom: 20px;
        }

        #routeImage {
            position: absolute;
            display: block;
            width:641px;
      		height:1553px;
        }

        #overlayCanvas {
            position: absolute;
        }

        #goToTopBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 5px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #goToTopBtn:hover {
            background-color: #45a049;
        }

        #goToTopBtn svg {
          width: 30px;
          height: 30px;
          fill: #4CAF50;
          vertical-align: middle;
        }

        html, body {
          scroll-behavior: smooth;
        }

        #calcButton{
            float: right;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px;
            background-color: #4caf50;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        input, select {
            text-align: center;
        }

        input[type='number']::-webkit-inner-spin-button, input[type='number']::-webkit-outer-spin-button { 
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="text"], input[type="number"], select, .selection, input[type="checkbox"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        input[type="checkbox"] {
            width: auto;
        }

        #resultContainer th, #resultContainer td {
            padding: 5px;
        }

        #resultContainer {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        #square0 {
			position: relative;
			display: inline-block;
			border: 1px solid black;
			height: 16px;
			width: 16px;
			background: #E34234;
		}

		#square1 {
			position: relative;
			display: inline-block;
			border: 1px solid black;
			height: 16px;
			width: 16px;
			background: #FFD700;
		}

		#square2 {
			position: relative;
			display: inline-block;
			border: 1px solid black;
			height: 16px;
			width: 16px;
			background: #0BDA51;
		}

		#resultContainer td {
        	font-family: Consolas;
		}

		.colorPicker {
			position: absolute;
			top: 0;
			left: 0;
			height: 100%;
			width: 100%;
			opacity: 0;
			cursor: pointer;
		}

		input:invalid {
			border: 2px solid red;
			outline: none;
		}

		.info {
			position:relative;
			cursor: help;
			color: blue;
	    }

	    .info span {
			display:none;
			-moz-border-radius:6px;
			-webkit-border-radius:6px;
			border-radius:6px;
			color:black;
			background:white;

	    }

	    .info span img {
			float:left;
	    }

	    .info:hover span, .info:active span {
			display : block;
			position : absolute;
			top : 0;
			left : 0;
			z-index : 1;
			border : 1px solid black;
			margin-top : 12px;
			margin-left : 12px;
			padding : 4px;
	    }

    </style>
</head>
<body>
<div class="container">
  <div class="row">
	<div class="col-md-6">
        <h1>Feebas Tile Calculator</h1>
        <p id="disclaimer">
        <span>The calculated Feebas tiles can only be reliably predicted if the trendy phrase in Dewford City was not changed manually. If you cannot find the words of your trendy phrase in the list, this means that the trend has been changed.</span>
        <a class="info" >
			<i class="fa" style="color:#3F00FF">&#xf059;</i>
			<span><img src="help.png"></span>
		</a>
        </p>
        <table class="inputTable"> 
            <form id="calculatorForm">
            	<tr>
                    <th><label id="game">Game</label></th>
                    <td><select id="gameOption" name="gameOption">
                            <option value="RS">Ruby/Sapphire</option>
                            <option value="Emerald">Emerald</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th><label for="trainerID">Trainer ID</label></th>
                    <td><input type="number" id="trainerID" name="trainerID" placeholder="00000" min="0" max="65535"></td>
                </tr>
                <tr>
                    <td colspan="2" style="font-weight:bold;"><label">Dewford Trend</label></td>
                </tr>
                <tr>
                    <th><label for="firstWord">First Word</label></th>
                    <td><input class="selection" list="firstWord" id="firstWordInput" value="HOT" onfocus="this.value='';validateInput()" onchange="this.blur();" onkeyup="validateInput()">
                    	<datalist id="firstWord"></datalist>
                    </td>
                </tr>
                <tr>
                    <th><label for="secondWord">Second Word</label></th>
                    <td><input class="selection" list="secondWord" id="secondWordInput" value="CHORES" onfocus="this.value='';validateInput()" onchange="this.blur();" onkeyup="validateInput()">
                    	<datalist id="secondWord"></datalist>
                    </td>
                </tr>
            </form>
        </table>
        <button type="button" id="calcButton" onclick="calculate()">Calculate</button>

        <table  id="resultContainer">
          <tr>
          	<th><input type="checkbox" id="result0Checkbox" checked onclick="calculate_if_generated()"></th>
            <th width="75%"> Feebas Random Value</div></th>
            <th><div id="square0"><input type="color" class="colorPicker" value="#E34234" id="colorPicker0"/></div></th>
            <td id="result0">0000</th>
          </tr>
          <tr>
          	<th><input type="checkbox" id="result1Checkbox" onclick="calculate_if_generated()"></th>
            <th>First Alternative</div></th>
            <th><div id="square1"><input type="color" class="colorPicker" value="#FFD700" id="colorPicker1"/></div></th>
            <td id="result1">0000</th>
          </tr>
          <tr>
          	<th><input type="checkbox" id="result2Checkbox" onclick="calculate_if_generated()"></th>
            <th>Second Alternative</div></th>
            <th><div id="square2"><input type="color" class="colorPicker" value="#0BDA51" id="colorPicker2"/></div></th>
            <td id="result2">0000</th>
          </tr>
      </table>
    </div>
    <div class="col-md-6" id="imageContainer">
        <p>Image credit: <a href="https://github.com/Bl4ckSh4rk/PKHeXFeebasLocatorPlugin/">Bl4ckSh4rk</a></p>
        <img src="route119.png" id="routeImage">
        <canvas id="overlayCanvas" width="641" height="1553"></canvas>
    </div>

  </div>
</div>

<button id="goToTopBtn" onclick="goToTop()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M7 11L12 6L17 11M12 18V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
</button>

    <script>
        var tileCoordinates = [ [0, 0], [0, 0], [0, 0], [0, 0], [289, 17], [289, 33], [305, 33], [257, 49],
                                [273, 49], [289, 49], [305, 49], [273, 65], [289, 65], [305, 65], [273, 81], [289, 81],
                                [305, 81], [273, 97], [289, 97], [305, 97], [273, 113], [289, 113], [305, 113], [273, 193],
                                [289, 193], [305, 193], [273, 209], [289, 209], [305, 209], [257, 225], [273, 225], [289, 225],
                                [305, 225], [321, 225], [257, 241], [273, 241], [289, 241], [305, 241], [321, 241], [257, 289],
                                [273, 289], [289, 289], [305, 289], [321, 289], [257, 305], [273, 305], [289, 305], [305, 305],
                                [321, 305], [257, 321], [273, 321], [289, 321], [305, 321], [321, 321], [257, 337], [273, 337],
                                [289, 337], [305, 337], [321, 337], [337, 337], [353, 337], [257, 353], [273, 353], [289, 353],
                                [305, 353], [321, 353], [337, 353], [353, 353], [257, 369], [273, 369], [289, 369], [305, 369],
                                [321, 369], [337, 369], [353, 369], [257, 385], [273, 385], [289, 385], [305, 385], [321, 385],
                                [337, 385], [353, 385], [257, 401], [273, 401], [289, 401], [305, 401], [321, 401], [337, 401],
                                [353, 401], [369, 401], [257, 417], [273, 417], [289, 417], [305, 417], [321, 417], [337, 417],
                                [353, 417], [369, 417], [385, 417], [401, 417], [417, 417], [433, 417], [449, 417], [465, 417],
                                [481, 417], [305, 433], [321, 433], [337, 433], [353, 433], [369, 433], [385, 433], [401, 433],
                                [417, 433], [433, 433], [449, 433], [465, 433], [481, 433], [497, 433], [513, 433], [321, 449],
                                [337, 449], [353, 449], [369, 449], [385, 449], [401, 449], [417, 449], [433, 449], [449, 449],
                                [465, 449], [481, 449], [497, 449], [513, 449], [369, 465], [385, 465], [401, 465], [417, 465],
                                [433, 465], [449, 465], [465, 465], [481, 465], [497, 465], [513, 465], [529, 465], [545, 465],
                                [433, 481], [449, 481], [465, 481], [481, 481], [497, 481], [513, 481], [529, 481], [545, 481],
                                [481, 497], [497, 497], [513, 497], [529, 497], [545, 497], [497, 513], [513, 513], [529, 513],
                                [545, 513], [561, 513], [497, 529], [513, 529], [529, 529], [497, 545], [513, 545], [529, 545],
                                [497, 561], [513, 561], [529, 561], [545, 561], [561, 561], [497, 577], [513, 577], [529, 577],
                                [545, 577], [561, 577], [529, 593], [545, 593], [561, 593], [529, 609], [545, 609], [561, 609],
                                [497, 625], [513, 625], [529, 625], [545, 625], [561, 625], [497, 641], [513, 641], [529, 641],
                                [545, 641], [561, 641], [481, 657], [497, 657], [513, 657], [529, 657], [545, 657], [561, 657],
                                [433, 673], [449, 673], [465, 673], [481, 673], [497, 673], [513, 673], [529, 673], [545, 673],
                                [417, 689], [433, 689], [449, 689], [465, 689], [481, 689], [497, 689], [513, 689], [529, 689],
                                [417, 705], [433, 705], [449, 705], [465, 705], [481, 705], [497, 705], [417, 721], [433, 721],
                                [449, 721], [465, 721], [481, 721], [497, 721], [417, 737], [433, 737], [449, 737], [465, 737],
                                [481, 737], [497, 737], [513, 737], [385, 753], [401, 753], [417, 753], [433, 753], [449, 753],
                                [465, 753], [385, 769], [401, 769], [417, 769], [433, 769], [449, 769], [353, 785], [369, 785],
                                [385, 785], [401, 785], [417, 785], [433, 785], [449, 785], [353, 801], [369, 801], [385, 801],
                                [401, 801], [417, 801], [433, 801], [449, 801], [353, 817], [369, 817], [385, 817], [401, 817],
                                [417, 817], [321, 833], [337, 833], [353, 833], [369, 833], [385, 833], [401, 833], [417, 833],
                                [321, 849], [337, 849], [353, 849], [369, 849], [385, 849], [401, 849], [321, 865], [337, 865],
                                [353, 865], [369, 865], [385, 865], [401, 865], [321, 881], [337, 881], [353, 881], [369, 881],
                                [385, 881], [401, 881], [321, 897], [337, 897], [353, 897], [369, 897], [337, 913], [337, 929],
                                [337, 1057], [353, 1057], [369, 1057], [225, 1297], [225, 1313], [225, 1329], [241, 1329], [257, 1329],
                                [305, 1329], [321, 1329], [369, 1329], [385, 1329], [225, 1345], [241, 1345], [257, 1345], [273, 1345],
                                [289, 1345], [305, 1345], [321, 1345], [337, 1345], [353, 1345], [369, 1345], [385, 1345], [225, 1361],
                                [241, 1361], [257, 1361], [273, 1361], [289, 1361], [305, 1361], [321, 1361], [337, 1361], [353, 1361],
                                [369, 1361], [385, 1361], [225, 1377], [241, 1377], [257, 1377], [273, 1377], [289, 1377], [305, 1377],
                                [321, 1377], [337, 1377], [353, 1377], [369, 1377], [385, 1377], [225, 1393], [241, 1393], [257, 1393],
                                [273, 1393], [289, 1393], [305, 1393], [321, 1393], [337, 1393], [353, 1393], [369, 1393], [385, 1393],
                                [401, 1393], [225, 1409], [241, 1409], [257, 1409], [273, 1409], [289, 1409], [305, 1409], [321, 1409],
                                [337, 1409], [353, 1409], [369, 1409], [385, 1409], [401, 1409], [145, 1425], [161, 1425], [177, 1425],
                                [193, 1425], [209, 1425], [225, 1425], [241, 1425], [257, 1425], [273, 1425], [289, 1425], [305, 1425],
                                [321, 1425], [369, 1425], [385, 1425], [401, 1425], [113, 1441], [129, 1441], [145, 1441], [161, 1441],
                                [177, 1441], [193, 1441], [209, 1441], [225, 1441], [241, 1441], [257, 1441], [273, 1441], [289, 1441],
                                [305, 1441], [321, 1441], [369, 1441], [385, 1441], [401, 1441], [145, 1457], [161, 1457], [177, 1457],
                                [193, 1457], [209, 1457], [225, 1457], [241, 1457], [257, 1457], [273, 1457], [289, 1457], [305, 1457],
                                [321, 1457], [337, 1457], [353, 1457], [369, 1457], [385, 1457], [401, 1457], [145, 1473], [161, 1473],
                                [177, 1473], [193, 1473], [209, 1473], [225, 1473], [241, 1473], [257, 1473], [273, 1473], [289, 1473],
                                [305, 1473], [321, 1473], [337, 1473], [353, 1473], [369, 1473], [129, 1489], [145, 1489], [161, 1489],
                                [177, 1489], [193, 1489], [209, 1489], [225, 1489], [241, 1489], [257, 1489], [273, 1489], [289, 1489],
                                [305, 1489], [129, 1505], [145, 1505], [161, 1505], [177, 1505], [193, 1505], [113, 1521], [129, 1521]];

        // 69 elements
		var conditions = ["HOT", "EXISTS", "EXCESS", "APPROVED", "HAS", "GOOD", "LESS", "MOMENTUM", "GOING", "WEIRD", "BUSY", "TOGETHER", "FULL", "ABSENT", "BEING", "NEED", "TASTY", "SKILLED", "NOISY", "BIG", "LATE", "CLOSE", "DOCILE", "AMUSING", "ENTERTAINING", "PERFECTION", "PRETTY", "HEALTHY", "EXCELLENT", "UPSIDE DOWN", "COLD", "REFRESHING", "UNAVOIDABLE", "MUCH", "OVERWHELMING", "FABULOUS", "ELSE", "EXPENSIVE", "CORRECT", "IMPOSSIBLE", "SMALL", "DIFFERENT", "TIRED", "SKILL", "TOP", "NON STOP", "PREPOSTEROUS", "NONE", "NOTHING", "NATURAL", "BECOMES", "LUKEWARM", "FAST", "LOW", "AWFUL", "ALONE", "BORED", "SECRET", "MYSTERY", "LACKS", "BEST", "LOUSY", "MISTAKE", "KIND", "WELL", "WEAKENED", "SIMPLE", "SEEMS", "BADLY"];

		// 45 elements
		var lifestyle = ["CHORES", "HOME", "MONEY", "ALLOWANCE", "BATH", "CONVERSATION", "SCHOOL", "COMMEMORATE", "HABIT", "GROUP", "WORD", "STORE", "SERVICE", "WORK", "SYSTEM", "TRAIN", "CLASS", "LESSONS", "INFORMATION", "LIVING", "TEACHER", "TOURNAMENT", "LETTER", "EVENT", "DIGITAL", "TEST", "DEPT STORE", "TELEVISION", "PHONE", "ITEM", "NAME", "NEWS", "POPULAR", "PARTY", "STUDY", "MACHINE", "MAIL", "MESSAGE", "PROMISE", "DREAM", "KINDERGARTEN", "LIFE", "RADIO", "RENTAL", "WORLD"];

		// 54 elements
		var hobbies = ["IDOL", "ANIME", "SONG", "MOVIE", "SWEETS", "CHAT", "CHILD S PLAY", "TOYS", "MUSIC", "CARDS", "SHOPPING", "CAMERA", "VIEWING", "SPECTATOR", "GOURMET", "GAME", "RPG", "COLLECTION", "COMPLETE", "MAGAZINE", "WALK", "BIKE", "HOBBY", "SPORTS", "SOFTWARE", "SONGS", "DIET", "TREASURE", "TRAVEL", "DANCE", "CHANNEL", "MAKING", "FISHING", "DATE", "DESIGN", "LOCOMOTIVE", "PLUSH DOLL", "PC", "FLOWERS", "HERO", "NAP", "HEROINE", "FASHION", "ADVENTURE", "BOARD", "BALL", "BOOK", "FESTIVAL", "COMICS", "HOLIDAY", "PLANS", "TRENDY", "VACATION", "LOOK"];

		var unreachable_tiles = [105, 119, 144, 296, 297, 298];

		var generated = false;

		var color0 = "#E34234";
		var color1 = "#FFD700";
		var color2 = "#0BDA51";

		$('#colorPicker0').on('change', function (e) {
			var optionSelected = $("option:selected", this);
			var valueSelected = this.value;
			$("#square0").css("background", valueSelected);

			color0 = valueSelected;
			calculate_if_generated();

		});


		$('#colorPicker1').on('change', function (e) {
			var optionSelected = $("option:selected", this);
			var valueSelected = this.value;
			$("#square1").css("background", valueSelected);

			color1 = valueSelected;
			calculate_if_generated();

		});

		$('#colorPicker2').on('change', function (e) {
			var optionSelected = $("option:selected", this);
			var valueSelected = this.value;
			$("#square2").css("background", valueSelected);

			color2 = valueSelected;
			calculate_if_generated();

		});

		// LCRNG algorithm
		function next(seed, n = 1, feebas = false){
			let rng = BigInt(seed);
			let mult = BigInt(1103515245);
			let add = feebas ? BigInt(12345) : BigInt(24691);

			for (let i = 0; i < n; i++) {
				rng = BigInt(mult * rng + add) & BigInt(0xFFFFFFFF);
			}
			return rng;
		}

		/*  Advances the PRNG state until after the Trainer ID was generated to prevent false
		    positives because the Dewford trend is only generated shortly after the Trainer ID */
		function advanceToTID(seed, tid){
			seed = BigInt(seed);
			while(seed >> BigInt(16) != tid){
				seed = next(seed);
			}
			return seed;
		}

		/*  Advances the PRNG state until after the minimum possible amount of advances after the dialogue
		    with Professor Birch to prevent false positives because the Dewford trend is generated during 
		    the shrinking animation just before teleporting inside the truck */
		function skipImpossibleAdvances(seed){
			seed = BigInt(seed);
			for(var i = 0; i < 700; i++){
				seed = next(seed);
			}
			return seed;
		}

		/*  Search for the first appearence of the combination of both words of the Dewford trend and return the
		    16Bit High value 7 advances after that which is usually the Feebas Random Value. Due to the varying
		    vblank interval, sometimes the Feebas Random Value is generated 6 or 8 advances after the first word
		    of the Dewford trend. These are proposed as alternative values  */
		function getFeebasRands(seed, word1, word2, is_emerald, tid){

			var first_word_index = conditions.indexOf(word1);     // The first word is always from the group conditions

			var second_word_from_group_lifestyle = 0; // The second word can be either from lifestyle or hobbies

			if(lifestyle.includes(word2)){
				second_word_from_group_lifestyle = 1;
				var second_word_index = lifestyle.indexOf(word2);
			}
			else{
				var second_word_index = hobbies.indexOf(word2);
			}

			seed = is_emerald ? skipImpossibleAdvances(seed) : advanceToTID(seed, tid);

			feebasRands = [];

			while(feebasRands.length < 3){ // Loop that finds three consecutive RNG calls that match the given words
				seed = next(seed);
				if((seed >> BigInt(16)) % BigInt(69) == first_word_index){ // Found match for first word index
			      
					if(((next(seed) >> BigInt(16)) & BigInt(1)) == second_word_from_group_lifestyle){ // Found match for group of second word
						var elements_in_second_group = second_word_from_group_lifestyle ? 45 : 54;

						if((next(seed,2) >> BigInt(16)) % BigInt(elements_in_second_group) == second_word_index){ // Found match for second word index
							var numAdvances;
							if((next(seed,4) >> BigInt(16)) % BigInt(98) > 50){

								// Additional Advances for trendiness values
								if((next(seed,5) >> BigInt(16)) % BigInt(98) > 80){
									numAdvances = 8;
								}
								else{
									numAdvances = 7;
								}
							}
							else{
								numAdvances = 6;
							}
							
							feebasRands.push(next(seed,numAdvances) >> BigInt(16));
							//return [next(seed,numAdvances) >> BigInt(16), next(seed,numAdvances+1) >> BigInt(16), next(seed,numAdvances-1) >> BigInt(16)]; // Return possible Feebas Random Values
			          }
			      }
			  }
			}

			return feebasRands;
		}


		/*  Calculate the Feebas Tiles based on the Feebas Random Value.
		    Tile 0 gets reassigned to tile 447 and tiles 1 to 3 are ignored */
		function getFeebasTiles(seed){

			tiles_list = [];
			tiles_found = 0;

			while(tiles_found < 6){
			  seed = next(seed, 1, feebas = true);
			  tile = (seed >> BigInt(16)) % BigInt(0x1bf);

			  if(tile == 0) tile = 447;

			  if(tile < 4) continue;

			  if(unreachable_tiles.includes(Number(tile))){
			  	tiles_found += 1;
			  	continue;
			  }

			  tiles_list.push(Number(tile));
			  tiles_found += 1;
			}
			return tiles_list;
		}

		const canvas = document.getElementById("overlayCanvas");
        const context = canvas.getContext("2d");

		var firstWordList = document.getElementById('firstWord');
		var secondWordList = document.getElementById('secondWord');

		conditions.forEach(function(item){
		   var option = document.createElement('option');
		   option.value = item;
		   firstWordList.appendChild(option);
		});

		lifestyle.concat(hobbies).forEach(function(item){
		   var option = document.createElement('option');
		   option.value = item;
		   secondWordList.appendChild(option);
		});

        function colorPixels(tileCoords, color) {
            context.fillStyle = color;//"rgba(255, 0, 0, 1)";
            if(tileCoords[0] == 369 && tileCoords[1] == 465){
            	context.fillRect(257, 257, 79, 31);
            	return;
            }
            context.fillRect(tileCoords[0], tileCoords[1], 15, 15);
        }

        function colorPixelsSplitTwo(tileCoords, color0, color1) {
        	if(tileCoords[0] == 369 && tileCoords[1] == 465){
        		context.fillStyle = "black";
        		context.fillRect(257, 257, 79, 31);
        		for(var i = 0; i < 5; i++){
        			var x = 257 + 16*i;
        			context.fillStyle = color0;
		            context.fillRect(x, 257, 7, 31);
		            context.fillStyle = color1;
		            context.fillRect(x+8, 257, 7, 31);
        		}
        		context.fillStyle = "black";
	            context.fillRect(257, 272, 79, 1);
            	return;
            }
            context.fillStyle = color0;
            context.fillRect(tileCoords[0], tileCoords[1], 7, 15);
            context.fillStyle = "black";
            context.fillRect(tileCoords[0]+7, tileCoords[1], 1, 15);
            context.fillStyle = color1;
            context.fillRect(tileCoords[0]+8, tileCoords[1], 7, 15);
        }

        function colorPixelsSplitThree(tileCoords, color0, color1, color2) {
        	var bridgeCoords = 257
        	if(tileCoords[0] == 369 && tileCoords[1] == 465){
        		context.fillStyle = "black";
	            context.fillRect(bridgeCoords, bridgeCoords, 79, 31);
	            context.fillStyle = color0;
	            context.fillRect(bridgeCoords, bridgeCoords, 79, 4);

	            for(var i = 0; i < 5; i++){
	            	context.fillRect(5+bridgeCoords+5*i, 4+bridgeCoords+2*i, 69-(10*i), 2);
	            }

	            context.fillStyle = color1;
	            context.fillRect(bridgeCoords, bridgeCoords+16, 38, 15);

	            for(var i = 0; i < 5; i++){
	            	context.fillRect(bridgeCoords, 6+bridgeCoords+2*i, 5+5*i, 2);
	            }

	            context.fillStyle = color2;
	            context.fillRect(bridgeCoords+41, bridgeCoords+16, 38, 15);

	            for(var i = 0; i < 5; i++){
	            	context.fillRect(bridgeCoords+74-5*i, 6+bridgeCoords+2*i, 5+5*i, 2);
	            }
	            return;
            }

            context.fillStyle = "black";
            context.fillRect(tileCoords[0], tileCoords[1], 15, 15);
            context.fillStyle = color0;
            context.fillRect(tileCoords[0], tileCoords[1], 15, 2);

            for(var i = 0; i < 5; i++){
            	context.fillRect(1+tileCoords[0]+i, 2+tileCoords[1]+i, 13-(2*i), 1);
            }

            context.fillStyle = color1;
            context.fillRect(tileCoords[0], tileCoords[1]+8, 7, 7);

            for(var i = 0; i < 5; i++){
            	context.fillRect(tileCoords[0], 3+tileCoords[1]+i, 1+i, 1);
            }

            context.fillStyle = color2;
            context.fillRect(tileCoords[0]+8, tileCoords[1]+8, 7, 7);

            for(var i = 0; i < 5; i++){
            	context.fillRect(tileCoords[0]+14-i, 3+tileCoords[1]+i, 1+i, 1);
            }

        }

        function colorTiles(tilesList, color0, color1, color2, overlaps){
        	const canvas = document.getElementById("overlayCanvas");
        	const context = canvas.getContext("2d");
        	switch(Number(overlaps)){
        		case 0:
        			tilesList.forEach((element) => colorPixels(tileCoordinates[element], color0));
        			break;
        		case 1:
        			tilesList.forEach((element) => colorPixelsSplitTwo(tileCoordinates[element], color0, color1));
        			break;
        		case 2:
        			tilesList.forEach((element) => colorPixelsSplitThree(tileCoordinates[element], color0, color1, color2));
        			break;
        	}
        }

        function validateInput() {
            var firstWord = document.getElementById("firstWordInput").value.toUpperCase();
            var secondWord = document.getElementById("secondWordInput").value.toUpperCase();
            var tid = document.getElementById("trainerID").value;

            var valid = true;

            if(tid < 0 || tid > 65535){
            	valid = false;
            }

            if (!conditions.includes(firstWord)) {
            	document.getElementById("firstWordInput").setCustomValidity("invalid");
                valid = false;
            }
            else{
            	document.getElementById("firstWordInput").setCustomValidity("");
            }

            if(!lifestyle.concat(hobbies).includes(secondWord)){
            	document.getElementById("secondWordInput").setCustomValidity("invalid");
            	valid = false;
            }
            else{
            	document.getElementById("secondWordInput").setCustomValidity("");
            }

            return valid;

        }

        function calculate() {

        	if(!validateInput()){
        		return;
        	}

        	const context = canvas.getContext('2d');
			context.clearRect(0, 0, canvas.width, canvas.height);
            var is_emerald = document.getElementById("gameOption").value;

			is_emerald = (is_emerald == 'Emerald') ? 1 : 0;

			var tid = document.getElementById("trainerID").value;
			var seed = is_emerald ? tid : 0x5a0;
			var word1 = document.getElementById("firstWordInput").value.toUpperCase();
			var word2 = document.getElementById("secondWordInput").value.toUpperCase();

			var showResult0 = +document.getElementById("result0Checkbox").checked;
			var showResult1 = +document.getElementById("result1Checkbox").checked;
			var showResult2 = +document.getElementById("result2Checkbox").checked;

			feeb_rands = getFeebasRands(seed, word1, word2, is_emerald, tid);

			var tiles = [ getFeebasTiles(feeb_rands[0]),
			            getFeebasTiles(feeb_rands[1]),
			            getFeebasTiles(feeb_rands[2])];

            overlap01 = [];
			overlap12 = [];
			overlap02 = [];
			overlap012 = [];

			tiles[0].forEach((element) => tiles[1].includes(element) ? overlap01.push(element) : null);
			tiles[1].forEach((element) => tiles[2].includes(element) ? overlap12.push(element) : null);
			tiles[0].forEach((element) => tiles[2].includes(element) ? overlap02.push(element) : null);
			overlap01.forEach((element) => overlap12.includes(element) ? overlap012.push(element) : null);

			if(showResult0) colorTiles(tiles[0], color0, null, null, 0);
			if(showResult1) colorTiles(tiles[1], color1, null, null, 0);
			if(showResult2) colorTiles(tiles[2], color2, null, null, 0);
			if(showResult0 && showResult1) colorTiles(overlap01, color0, color1, null, 1);
			if(showResult1 && showResult2) colorTiles(overlap12, color1, color2, null, 1);
			if(showResult0 && showResult2) colorTiles(overlap02, color0, color2, null, 1);
			if(showResult0 && showResult1 && showResult2) colorTiles(overlap012, color0, color1, color2, 2);

			document.getElementById("result0").innerHTML = feeb_rands[0].toString(16).toUpperCase();
			document.getElementById("result1").innerHTML = feeb_rands[1].toString(16).toUpperCase();
			document.getElementById("result2").innerHTML = feeb_rands[2].toString(16).toUpperCase();

			generated = true;
        }

        function calculate_if_generated(){
        	if(generated){
        		calculate();
        	}
        }

        window.onscroll = function () {
        	toggleGoToTopButton();
	    };

	    function toggleGoToTopButton() {
	        const goToTopBtn = document.getElementById('goToTopBtn');
	        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
	            goToTopBtn.style.display = 'block';
	        } else {
	            goToTopBtn.style.display = 'none';
	        }
	    }

	    function goToTop() {
	        document.body.scrollTop = 0;
	        document.documentElement.scrollTop = 0;
	    }
    </script>
</body>
</html>
